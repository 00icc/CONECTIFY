<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CONECTIFY</title>
  <style>
    :root {
      --background: rgba(245, 245, 245, 0.8);
      --surface: rgba(255, 255, 255, 0.7);
      --text-primary: #000000;
      --text-secondary: #666666;
      --accent: rgba(0, 122, 255, 0.9);
      --accent-hover: rgba(0, 86, 179, 0.95);
      --border: rgba(224, 224, 224, 0.3);
      --status-success-bg: rgba(212, 237, 218, 0.7);
      --status-success-text: #155724;
      --status-error-bg: rgba(248, 215, 218, 0.7);
      --status-error-text: #721c24;
      --shadow: rgba(0, 0, 0, 0.1);
      --glass-border: rgba(255, 255, 255, 0.1);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      --backdrop-blur: 12px;
    }

    [data-theme='dark'] {
      --background: rgba(28, 28, 30, 0.8);
      --surface: rgba(44, 44, 46, 0.7);
      --text-primary: #ffffff;
      --text-secondary: rgba(152, 152, 157, 0.9);
      --accent: rgba(10, 132, 255, 0.9);
      --accent-hover: rgba(64, 156, 255, 0.95);
      --border: rgba(58, 58, 60, 0.3);
      --status-success-bg: rgba(28, 56, 50, 0.7);
      --status-success-text: #34c759;
      --status-error-bg: rgba(59, 27, 27, 0.7);
      --status-error-text: #ff453a;
      --shadow: rgba(0, 0, 0, 0.3);
      --glass-border: rgba(255, 255, 255, 0.05);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, var(--background) 0%, var(--background) 50%, rgba(255, 255, 255, 0.05) 100%);
      color: var(--text-primary);
      transition: background 0.3s ease, color 0.3s ease;
      min-height: 100vh;
      backdrop-filter: blur(var(--backdrop-blur));
      -webkit-backdrop-filter: blur(var(--backdrop-blur));
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: var(--surface);
      border-radius: 20px;
      box-shadow: var(--glass-shadow);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(var(--backdrop-blur));
      -webkit-backdrop-filter: blur(var(--backdrop-blur));
    }

    .section {
      margin: 20px 0;
      padding: 20px;
      background: var(--surface);
      border-radius: 15px;
      box-shadow: var(--glass-shadow);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(var(--backdrop-blur));
      -webkit-backdrop-filter: blur(var(--backdrop-blur));
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .section:hover {
      transform: translateY(-2px);
      box-shadow: var(--glass-shadow), 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    .button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(var(--backdrop-blur));
      -webkit-backdrop-filter: blur(var(--backdrop-blur));
    }

    .button:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .status {
      margin-top: 10px;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 14px;
      backdrop-filter: blur(var(--backdrop-blur));
      -webkit-backdrop-filter: blur(var(--backdrop-blur));
      transition: all 0.3s ease;
    }

    .status.success {
      background: var(--status-success-bg);
      color: var(--status-success-text);
      border: 1px solid var(--status-success-text);
    }

    .status.error {
      background: var(--status-error-bg);
      color: var(--status-error-text);
      border: 1px solid var(--status-error-text);
    }

    .path-input {
      width: 100%;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.3s ease;
      backdrop-filter: blur(var(--backdrop-blur));
      -webkit-backdrop-filter: blur(var(--backdrop-blur));
    }

    .path-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);
    }
    
    .theme-switch {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: var(--surface);
      border-radius: 20px;
      box-shadow: var(--glass-shadow);
      border: 1px solid var(--glass-border);
      -webkit-backdrop-filter: blur(var(--backdrop-blur));
      backdrop-filter: blur(var(--backdrop-blur));
      z-index: 1000;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 51px;
      height: 31px;
      margin: 0 8px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
      margin: 0;
      padding: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 34px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 27px;
      width: 27px;
      left: 2px;
      bottom: 2px;
      background-color: var(--surface);
      transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    input:checked + .slider {
      background-color: var(--accent);
    }

    input:checked + .slider:before {
      transform: translateX(20px);
    }

    .theme-switch span {
      font-size: 16px;
      transition: opacity 0.3s ease;
      opacity: 0.7;
    }

    .theme-switch:hover span {
      opacity: 1;
    }

    .welcome-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .welcome-overlay.visible {
      opacity: 1;
      visibility: visible;
    }

    .welcome-content {
      background: var(--surface);
      padding: 30px;
      border-radius: 20px;
      max-width: 500px;
      width: 90%;
      box-shadow: var(--glass-shadow);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(var(--backdrop-blur));
      -webkit-backdrop-filter: blur(var(--backdrop-blur));
      position: relative;
    }

    .welcome-step {
      display: none;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .welcome-step.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .welcome-title {
      font-size: 24px;
      margin-bottom: 15px;
      color: var(--text-primary);
    }

    .welcome-description {
      color: var(--text-secondary);
      margin-bottom: 25px;
      line-height: 1.5;
    }

    .welcome-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }

    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--border);
      margin: 0 5px;
      transition: background-color 0.3s ease;
    }

    .progress-dot.active {
      background: var(--accent);
    }

    .welcome-progress {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
  </style>
  
  <!-- cSpell:ignore CONECTIFY -->
  <div class="theme-switch">
    <span>‚òÄÔ∏è</span>
    <label class="switch">
      <input type="checkbox" id="themeToggle" aria-label="Toggle dark mode">
      <span class="slider"></span>
    </label>
    <span>üåô</span>
  </div>

  <div class="welcome-overlay visible" id="welcomeOverlay">
    <div class="welcome-content">
      <div class="welcome-step active" data-step="1">
        <h2 class="welcome-title">Welcome to CONECTIFY</h2>
        <p class="welcome-description">Let's get you set up with a seamless bridge between After Effects and DaVinci Resolve. We'll guide you through the installation and show you how everything works.</p>
        <div class="welcome-navigation">
          <button class="button" onclick="skipTutorial()">Skip Tutorial</button>
          <button class="button" onclick="nextStep()">Get Started</button>
        </div>
      </div>

      <div class="welcome-step" data-step="2">
        <h2 class="welcome-title">Installation</h2>
        <p class="welcome-description">First, we'll check if After Effects and DaVinci Resolve are properly installed and accessible.</p>
        <button id="welcomeCheckInstall" class="button">Check Installation</button>
        <div id="welcomeInstallStatus" class="status"></div>
        <div class="welcome-navigation">
          <button class="button" onclick="prevStep()">Back</button>
          <button class="button" onclick="nextStep()" id="installNextBtn" disabled>Next</button>
        </div>
      </div>

      <div class="welcome-step" data-step="3">
        <h2 class="welcome-title">Bridge Setup</h2>
        <p class="welcome-description">Now let's configure the bridge between After Effects and DaVinci Resolve. This will allow seamless communication between the applications.</p>
        <button id="welcomeConfigureAE" class="button">Configure After Effects</button>
        <button id="welcomeConfigureResolve" class="button">Configure DaVinci Resolve</button>
        <div id="welcomeConfigStatus" class="status"></div>
        <div class="welcome-navigation">
          <button class="button" onclick="prevStep()">Back</button>
          <button class="button" onclick="nextStep()" id="configNextBtn" disabled>Next</button>
        </div>
      </div>

      <div class="welcome-step" data-step="4">
        <h2 class="welcome-title">All Set!</h2>
        <p class="welcome-description">Great job! You're now ready to use CONECTIFY. Let's start by testing the bridge connection.</p>
        <div class="welcome-navigation">
          <button class="button" onclick="prevStep()">Back</button>
          <button class="button" onclick="finishTutorial()">Start Using CONECTIFY</button>
        </div>
      </div>

      <div class="welcome-progress">
        <div class="progress-dot active" data-step="1"></div>
        <div class="progress-dot" data-step="2"></div>
        <div class="progress-dot" data-step="3"></div>
        <div class="progress-dot" data-step="4"></div>
      </div>
    </div>
  </div>

  <div class="container">
    <h1>CONECTIFY</h1>
    
    <div class="section">
      <h2>Installation Status</h2>
      <button id="checkInstall" class="button">Check Installation</button>
      <div id="installStatus" class="status"></div>
      <div id="pathConfig" style="display: none; margin-top: 20px;">
        <h3>Application Paths</h3>
        <div style="margin: 10px 0;">
          <label>After Effects Path:</label>
          <input type="text" id="aePath" class="path-input">
        </div>
        <div style="margin: 10px 0;">
          <label>DaVinci Resolve Path:</label>
          <input type="text" id="resolvePath" class="path-input">
        </div>
        <button id="savePaths" class="button">Save Paths</button>
      </div>
    </div>

    <div class="section">
      <h2>Bridge Operations</h2>
      <button id="startBridge" class="button">Start Bridge</button>
      <button id="stopBridge" class="button" disabled>Stop Bridge</button>
      <div id="bridgeStatus" class="status"></div>
    </div>

    <div class="section">
      <h2>Settings</h2>
      <button id="configureAE" class="button">Configure After Effects</button>
      <button id="configureResolve" class="button">Configure DaVinci Resolve</button>
      <div id="settingsStatus" class="status"></div>
    </div>
  </div>

  <script>
  const { ipcRenderer } = require('electron');

  // Theme handling
  const themeToggle = document.getElementById('themeToggle');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');

  // Load saved theme preference and initialize theme toggle
  function initializeTheme() {
    const savedTheme = localStorage.getItem('theme');
    const systemPrefersDark = prefersDark.matches;
    const shouldUseDark = savedTheme === 'dark' || (!savedTheme && systemPrefersDark);
    
    document.documentElement.setAttribute('data-theme', shouldUseDark ? 'dark' : 'light');
    themeToggle.checked = shouldUseDark;
    
    // Apply initial transitions
    document.querySelectorAll('.section, .container, .welcome-content').forEach(element => {
      element.style.transition = 'all 0.3s ease';
    });

    // Force a reflow to ensure styles are applied
    document.documentElement.offsetHeight;
  }
  
  initializeTheme();

  // Listen for system theme changes
  prefersDark.addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) {
      const newTheme = e.matches ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', newTheme);
      themeToggle.checked = e.matches;
    }
  });

  // Theme toggle handler with transition
  themeToggle.addEventListener('change', () => {
    const newTheme = themeToggle.checked ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    // Ensure smooth transition of all themed elements
    document.querySelectorAll('.section, .container, .welcome-content, .status, .button, .path-input').forEach(element => {
      element.style.transition = 'all 0.3s ease';
    });

    // Force a reflow to ensure transitions are applied
    document.documentElement.offsetHeight;
  });

  // Welcome screen handling
  let currentStep = 1;
  const totalSteps = 4;

  function updateProgress() {
    document.querySelectorAll('.progress-dot').forEach(dot => {
      dot.classList.remove('active');
      if (parseInt(dot.dataset.step) <= currentStep) {
        dot.classList.add('active');
      }
    });
  }

  function showStep(step) {
    document.querySelectorAll('.welcome-step').forEach(s => {
      s.classList.remove('active');
      if (parseInt(s.dataset.step) === step) {
        s.classList.add('active');
      }
    });
    currentStep = step;
    updateProgress();
  }

  function nextStep() {
    if (currentStep < totalSteps) {
      showStep(currentStep + 1);
    }
  }

  function prevStep() {
    if (currentStep > 1) {
      showStep(currentStep - 1);
    }
  }

  async function skipTutorial() {
    try {
      await ipcRenderer.invoke('skip-tutorial');
      const overlay = document.getElementById('welcomeOverlay');
      overlay.style.opacity = '0';
      setTimeout(() => {
        overlay.classList.remove('visible');
        overlay.style.opacity = '';
      }, 300);
      localStorage.setItem('tutorialComplete', 'true');
    } catch (error) {
      console.error('Error skipping tutorial:', error);
    }
  }

  async function finishTutorial() {
    await ipcRenderer.invoke('finish-tutorial');
    document.getElementById('welcomeOverlay').classList.remove('visible');
    localStorage.setItem('tutorialComplete', 'true');
  }

  // Check if tutorial has been completed
  if (localStorage.getItem('tutorialComplete') === 'true') {
    document.getElementById('welcomeOverlay').classList.remove('visible');
  }

  // Welcome screen installation check
  document.getElementById('welcomeCheckInstall').addEventListener('click', async () => {
    const status = document.getElementById('welcomeInstallStatus');
    const nextBtn = document.getElementById('installNextBtn');
    
    try {
      status.textContent = 'Checking installation...';
      status.className = 'status';
      
      const result = await window.electron.checkInstallation();
      if (result.success) {
        const hasError = result.checks?.some(check => !check.status);
        
        if (!hasError) {
          status.textContent = 'All applications are properly installed!';
          status.className = 'status success';
          nextBtn.disabled = false;
        } else {
          status.textContent = 'Some applications need configuration. Please check the settings.';
          status.className = 'status error';
          nextBtn.disabled = true;
        }
      } else {
        status.textContent = result.message || 'Installation check failed. Please install required applications.';
        status.className = 'status error';
        nextBtn.disabled = true;
      }
    } catch (error) {
      status.textContent = `Error checking installation: ${error.message}`;
      status.className = 'status error';
      nextBtn.disabled = true;
    }
  });

  document.getElementById('welcomeConfigureAE').addEventListener('click', async () => {
    const status = document.getElementById('welcomeConfigStatus');
    const nextBtn = document.getElementById('configNextBtn');
    
    try {
      status.textContent = 'Configuring After Effects...';
      status.className = 'status';
      
      const result = await window.electron.configureApp('ae');
      if (result.success) {
        status.textContent = 'After Effects configured successfully!';
        status.className = 'status success';
        // Enable next button only if both apps are configured
        const resolveStatus = await window.electron.getBridgeStatus();
        if (resolveStatus.resolve.configured) {
          nextBtn.disabled = false;
        }
      } else {
        throw new Error(result.error || 'Failed to configure After Effects');
      }
    } catch (error) {
      status.textContent = `Error configuring After Effects: ${error.message}`;
      status.className = 'status error';
    }
  });

  document.getElementById('welcomeConfigureResolve').addEventListener('click', async () => {
    const status = document.getElementById('welcomeConfigStatus');
    const nextBtn = document.getElementById('configNextBtn');
    
    try {
      status.textContent = 'Configuring DaVinci Resolve...';
      status.className = 'status';
      
      const result = await window.electron.configureApp('resolve');
      if (result.success) {
        status.textContent = 'DaVinci Resolve configured successfully!';
        status.className = 'status success';
        // Enable next button only if both apps are configured
        const aeStatus = await window.electron.getBridgeStatus();
        if (aeStatus.ae.configured) {
          nextBtn.disabled = false;
        }
      } else {
        throw new Error(result.error || 'Failed to configure DaVinci Resolve');
      }
    } catch (error) {
      status.textContent = `Error configuring DaVinci Resolve: ${error.message}`;
      status.className = 'status error';
    }
  });

  // Installation check
  document.getElementById('checkInstall').addEventListener('click', async () => {
    const status = document.getElementById('installStatus');
    const pathConfig = document.getElementById('pathConfig');
    const checkInstallBtn = document.getElementById('checkInstall');
    
    try {
      checkInstallBtn.disabled = true;
      status.textContent = 'Checking installation...';
      status.className = 'status';
      
      const result = await window.electron.checkInstallation();
      if (result.success) {
        const hasError = result.checks?.some(check => !check.status);
        
        if (!hasError) {
          status.textContent = 'All applications are properly installed!';
          status.className = 'status success';
          pathConfig.style.display = 'none';
        } else {
          status.textContent = 'Some applications need configuration. Please check the settings.';
          status.className = 'status error';
          pathConfig.style.display = 'block';
          
          // Load current paths
          const paths = await window.electron.getPaths();
          document.getElementById('aePath').value = paths.ae || '';
          document.getElementById('resolvePath').value = paths.resolve || '';
        }
      } else {
        status.textContent = result.message || 'Installation check failed. Please configure paths manually.';
        status.className = 'status error';
        pathConfig.style.display = 'block';
      }
    } catch (error) {
      status.textContent = `Error checking installation: ${error.message}`;
      status.className = 'status error';
      pathConfig.style.display = 'block';
    } finally {
      checkInstallBtn.disabled = false;
    }
  });

  document.getElementById('savePaths').addEventListener('click', async () => {
    const status = document.getElementById('installStatus');
    const pathConfig = document.getElementById('pathConfig');
    
    try {
      const aePath = document.getElementById('aePath').value;
      const resolvePath = document.getElementById('resolvePath').value;
      
      if (!aePath || !resolvePath) {
        throw new Error('Please provide both paths');
      }
      
      status.textContent = 'Saving paths...';
      status.className = 'status';
      
      const result = await window.electron.savePaths({ ae: aePath, resolve: resolvePath });
      if (result.success) {
        status.textContent = 'Paths saved successfully!';
        status.className = 'status success';
        pathConfig.style.display = 'none';
      } else {
        throw new Error(result.error || 'Failed to save paths');
      }
    } catch (error) {
      status.textContent = `Error saving paths: ${error.message}`;
      status.className = 'status error';
    }
    try {
      const aePath = document.getElementById('aePath').value;
      const resolvePath = document.getElementById('resolvePath').value;

      const result = await ipcRenderer.invoke('save-paths', { aePath, resolvePath });
      if (result.success) {
        status.textContent = 'Paths updated successfully. Please check installation again.';
        status.className = 'status success';
      } else {
        throw new Error(result.error || 'Failed to update paths');
      }
    } catch (error) {
      status.textContent = `Error updating paths: ${error.message}`;
      status.className = 'status error';
    }
  });

  // Bridge operations
  document.getElementById('startBridge').addEventListener('click', async () => {
    const status = document.getElementById('bridgeStatus');
    const startBtn = document.getElementById('startBridge');
    const stopBtn = document.getElementById('stopBridge');

    try {
      status.textContent = 'Starting bridge...';
      status.className = 'status';
      startBtn.disabled = true;
      
      const result = await window.electron.bridgeOperation('start');
      if (result.success) {
        status.textContent = 'Bridge is running';
        status.className = 'status success';
        startBtn.disabled = true;
        stopBtn.disabled = false;
      } else {
        throw new Error(result.error || 'Failed to start bridge');
      }
    } catch (error) {
      status.textContent = `Error starting bridge: ${error.message}`;
      status.className = 'status error';
      startBtn.disabled = false;
      stopBtn.disabled = true;
    }
    try {
      status.textContent = 'Starting bridge...';
      status.className = 'status';
      const result = await ipcRenderer.invoke('bridge-operation', { action: 'start' });
      if (result.success) {
        status.textContent = result.message;
        status.className = 'status success';
        document.getElementById('startBridge').disabled = true;
        document.getElementById('stopBridge').disabled = false;
      } else {
        throw new Error(result.message || 'Failed to start bridge');
      }
    } catch (error) {
      status.textContent = `Error starting bridge: ${error.message}`;
      status.className = 'status error';
    }
  });

  document.getElementById('stopBridge').addEventListener('click', async () => {
    const status = document.getElementById('bridgeStatus');
    const startBtn = document.getElementById('startBridge');
    const stopBtn = document.getElementById('stopBridge');

    try {
      status.textContent = 'Stopping bridge...';
      status.className = 'status';
      stopBtn.disabled = true;
      
      const result = await window.electron.bridgeOperation('stop');
      if (result.success) {
        status.textContent = 'Bridge stopped';
        status.className = 'status';
        startBtn.disabled = false;
        stopBtn.disabled = true;
      } else {
        throw new Error(result.error || 'Failed to stop bridge');
      }
    } catch (error) {
      status.textContent = `Error stopping bridge: ${error.message}`;
      status.className = 'status error';
      startBtn.disabled = false;
      stopBtn.disabled = false;
    }
    try {
      status.textContent = 'Stopping bridge...';
      status.className = 'status';
      const result = await ipcRenderer.invoke('bridge-operation', { action: 'stop' });
      if (result.success) {
        status.textContent = result.message;
        status.className = 'status';
        document.getElementById('startBridge').disabled = false;
        document.getElementById('stopBridge').disabled = true;
      } else {
        throw new Error(result.message || 'Failed to stop bridge');
      }
    } catch (error) {
      status.textContent = `Error stopping bridge: ${error.message}`;
      status.className = 'status error';
    }
  });

  document.getElementById('savePaths').addEventListener('click', async () => {
    const status = document.getElementById('installStatus');
    const pathConfig = document.getElementById('pathConfig');
    
    try {
      const aePath = document.getElementById('aePath').value;
      const resolvePath = document.getElementById('resolvePath').value;
      
      if (!aePath || !resolvePath) {
        throw new Error('Please provide both paths');
      }
      
      status.textContent = 'Saving paths...';
      status.className = 'status';
      
      const result = await window.electron.savePaths({ ae: aePath, resolve: resolvePath });
      if (result.success) {
        status.textContent = 'Paths saved successfully!';
        status.className = 'status success';
        pathConfig.style.display = 'none';
      } else {
        throw new Error(result.error || 'Failed to save paths');
      }
    } catch (error) {
      status.textContent = `Error saving paths: ${error.message}`;
      status.className = 'status error';
    }
    const aePath = document.getElementById('aePath').value.trim();
    const resolvePath = document.getElementById('resolvePath').value.trim();

    if (!aePath || !resolvePath) {
      status.textContent = 'Please provide both application paths';
      status.className = 'status error';
      return;
    }

    try {
      status.textContent = 'Saving paths...';
      status.className = 'status';
      const result = await ipcRenderer.invoke('save-paths', { aePath, resolvePath });
      if (result.success) {
        status.textContent = 'Paths saved successfully!';
        status.className = 'status success';
        document.getElementById('pathConfig').style.display = 'none';
      } else {
        throw new Error(result.message || 'Failed to save paths');
      }
    } catch (error) {
      status.textContent = `Error saving paths: ${error.message}`;
      status.className = 'status error';
    }
  });

  // Configuration button handlers
  document.getElementById('configureAE').addEventListener('click', async () => {
    const status = document.getElementById('settingsStatus');
    
    try {
      status.textContent = 'Configuring After Effects...';
      status.className = 'status';
      
      const result = await window.electron.configureApp('ae');
      if (result.success) {
        status.textContent = 'After Effects configured successfully!';
        status.className = 'status success';
        // Enable next button only if both apps are configured
        const resolveStatus = await window.electron.getBridgeStatus();
        if (resolveStatus.resolve.configured) {
          nextBtn.disabled = false;
        }
      } else {
        throw new Error(result.error || 'Failed to configure After Effects');
      }
    } catch (error) {
      status.textContent = `Error configuring After Effects: ${error.message}`;
      status.className = 'status error';
    }
  });

  document.getElementById('configureResolve').addEventListener('click', async () => {
    const status = document.getElementById('settingsStatus');
    
    try {
      status.textContent = 'Configuring DaVinci Resolve...';
      status.className = 'status';
      
      const result = await window.electron.configureApp('resolve');
      if (result.success) {
        status.textContent = 'DaVinci Resolve configured successfully!';
        status.className = 'status success';
      } else {
        throw new Error(result.error || 'Failed to configure DaVinci Resolve');
      }
    } catch (error) {
      status.textContent = `Error configuring DaVinci Resolve: ${error.message}`;
      status.className = 'status error';
    }
    try {
      status.textContent = 'Configuring DaVinci Resolve...';
      status.className = 'status';
      const result = await ipcRenderer.invoke('configure-app', { app: 'DaVinci Resolve' });
      if (result.success) {
        status.textContent = result.message;
        status.className = 'status success';
      } else {
        throw new Error(result.message || 'Failed to configure DaVinci Resolve');
      }
    } catch (error) {
      status.textContent = `Error: ${error.message}`;
      status.className = 'status error';
    }
  });

  // Cleanup function for event listeners
  window.addEventListener('unload', () => {
    ['configureAE', 'configureResolve', 'startBridge', 'stopBridge', 'savePaths', 'checkInstall'].forEach(id => {
      const element = document.getElementById(id);
      if (element) {
        element.replaceWith(element.cloneNode(true));
      }
    });
  });

  // Initial state check
  window.addEventListener('load', async () => {
    try {
      const bridgeStatus = await ipcRenderer.invoke('get-bridge-status');
      if (bridgeStatus.running) {
        document.getElementById('startBridge').disabled = true;
        document.getElementById('stopBridge').disabled = false;
        document.getElementById('bridgeStatus').textContent = 'Bridge is running';
        document.getElementById('bridgeStatus').className = 'status success';
      } else {
        document.getElementById('startBridge').disabled = false;
        document.getElementById('stopBridge').disabled = true;
        document.getElementById('bridgeStatus').textContent = 'Bridge is stopped';
        document.getElementById('bridgeStatus').className = 'status';
      }
    } catch (error) {
      console.error('Failed to get initial bridge status:', error);
      document.getElementById('bridgeStatus').textContent = `Error: ${error.message}`;
      document.getElementById('bridgeStatus').className = 'status error';
    }
  });
</script>
</body>
</html>

